<!DOCTYPE html>
<html lang="nl">
  <head>
    <meta charset="UTF-8" />
    <meta
      name="viewport"
      content="width=device-width, initial-scale=1.0"
    />
    <title>Het Innovatie Portfolio Spel</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link
      rel="preconnect"
      href="https://fonts.googleapis.com"
    />
    <link
      rel="preconnect"
      href="https://fonts.gstatic.com"
      crossorigin
    />
    <link
      href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&display=swap"
      rel="stylesheet"
    />
    <style>
      body {
        font-family: "Inter", sans-serif;
      }
      .card-enter {
        animation: card-enter 0.5s ease-out;
      }
      @keyframes card-enter {
        from {
          opacity: 0;
          transform: translateY(20px);
        }
        to {
          opacity: 1;
          transform: translateY(0);
        }
      }
      .modal-backdrop {
        transition: opacity 0.3s ease;
      }
      .modal-content {
        transition: transform 0.3s ease, opacity 0.3s ease;
      }
      .bar {
        transition: width 0.5s ease-in-out;
      }
    </style>
  </head>
  <body
    class="bg-slate-50 text-slate-800 flex items-center justify-center min-h-screen p-4"
  >
    <div class="w-full max-w-5xl mx-auto">
      <header class="text-center mb-6">
        <h1 class="text-3xl md:text-4xl font-bold text-slate-900">
          Het Innovatie Portfolio Spel
        </h1>
        <p class="text-slate-600 mt-2">
          Verdeel je budget tussen zekerheid (Exploit) en risico (Explore).
        </p>
      </header>

      <!-- Dashboard -->
      <div class="grid grid-cols-2 md:grid-cols-4 gap-4 mb-6 text-center">
        <div class="bg-white p-4 rounded-xl shadow-sm border border-slate-200">
          <h3 class="text-sm font-semibold text-slate-500 uppercase">Jaar</h3>
          <p
            id="current-year"
            class="text-2xl font-bold text-blue-600"
          >
            1 / 5
          </p>
        </div>
        <div class="bg-white p-4 rounded-xl shadow-sm border border-slate-200">
          <h3 class="text-sm font-semibold text-slate-500 uppercase">
            Startbudget
          </h3>
          <p
            id="start-budget"
            class="text-2xl font-bold text-slate-800"
          >
            €100M
          </p>
        </div>
        <div class="bg-white p-4 rounded-xl shadow-sm border border-slate-200">
          <h3 class="text-sm font-semibold text-slate-500 uppercase">
            Geïnvesteerd
          </h3>
          <p
            id="invested-amount"
            class="text-2xl font-bold text-slate-800"
          >
            €0M
          </p>
        </div>
        <div class="bg-white p-4 rounded-xl shadow-sm border border-slate-200">
          <h3 class="text-sm font-semibold text-slate-500 uppercase">
            Resterend Budget
          </h3>
          <p
            id="remaining-budget"
            class="text-2xl font-bold text-green-600"
          >
            €100M
          </p>
        </div>
      </div>

      <!-- Investment Cards -->
      <main class="grid md:grid-cols-3 gap-6">
        <!-- Card 1: Exploit -->
        <div
          class="bg-white p-6 rounded-xl shadow-sm border border-slate-200 card-enter"
        >
          <div class="flex items-center mb-4">
            <div class="bg-blue-100 text-blue-600 p-3 rounded-lg mr-4">
              <svg
                xmlns="http://www.w3.org/2000/svg"
                width="24"
                height="24"
                viewBox="0 0 24 24"
                fill="none"
                stroke="currentColor"
                stroke-width="2"
                stroke-linecap="round"
                stroke-linejoin="round"
              >
                <path
                  d="M3 20.4V3.6C3 3.26863 3.26863 3 3.6 3H20.4C20.7314 3 21 3.26863 21 3.6V20.4C21 20.7314 20.7314 21 20.4 21H3.6C3.26863 21 3 20.7314 3 20.4Z"
                  stroke-width="1.5"
                ></path>
                <path
                  d="M15 8.5C14.315 7.81501 13.1087 7.33855 12 7.30872M9 15C9.64448 15.8593 10.8428 16.3494 12 16.391M12 7.30872C10.6809 7.27322 9.5 7.86998 9.5 9.50001C9.5 12.5 15 11 15 14C15 15.711 13.5362 16.4462 12 16.391M12 7.30872V5.5M12 16.391V18.5"
                  stroke-width="1.5"
                  stroke-linecap="round"
                  stroke-linejoin="round"
                ></path>
              </svg>
            </div>
            <div>
              <h2 class="text-xl font-bold text-slate-900">
                Project 'Cash Cow'
              </h2>
              <p class="text-sm font-medium text-blue-600">EXPLOIT</p>
            </div>
          </div>
          <p class="text-slate-600 mb-4">
            Optimaliseer de kernactiviteiten. Een veilige, voorspelbare
            investering.
          </p>
          <div class="bg-slate-100 p-3 rounded-lg mb-4">
            <p><strong>Kosten per unit:</strong> €20M</p>
            <div class="project-details mt-2 pt-2 border-t border-slate-200">
              <p>
                <strong>Opbrengst:</strong> Gegarandeerd €25M
                <span class="text-green-600 font-semibold">(+€5M winst)</span>
              </p>
            </div>
          </div>
          <label
            for="invest-cash-cow"
            class="font-semibold text-slate-700"
            >Aantal investeringen:</label
          ><input
            type="number"
            id="invest-cash-cow"
            min="0"
            value="0"
            class="mt-2 w-full p-2 rounded-lg border-slate-300 border focus:ring-2 focus:ring-blue-500 focus:border-blue-500 transition"
          />
        </div>
        <!-- Card 2: Sustaining Innovation -->
        <div
          class="bg-white p-6 rounded-xl shadow-sm border border-slate-200 card-enter"
        >
          <div class="flex items-center mb-4">
            <div class="bg-purple-100 text-purple-600 p-3 rounded-lg mr-4">
              <svg
                xmlns="http://www.w3.org/2000/svg"
                width="24"
                height="24"
                viewBox="0 0 24 24"
                fill="none"
                stroke="currentColor"
                stroke-width="2"
                stroke-linecap="round"
                stroke-linejoin="round"
              >
                <path
                  d="M20 20H4V4"
                  stroke-width="1.5"
                  stroke-linecap="round"
                  stroke-linejoin="round"
                ></path>
                <path
                  d="M4 16.5L12 9L15 12L19.5 7.5"
                  stroke-width="1.5"
                  stroke-linecap="round"
                  stroke-linejoin="round"
                ></path>
              </svg>
            </div>
            <div>
              <h2 class="text-xl font-bold text-slate-900">
                Project 'Better Faster'
              </h2>
              <p class="text-sm font-medium text-purple-600">SUSTAIN</p>
            </div>
          </div>
          <p class="text-slate-600 mb-4">
            Verbeter bestaande processen. Een berekend risico met een goede kans
            op succes.
          </p>
          <div class="bg-slate-100 p-3 rounded-lg mb-4">
            <p><strong>Kosten per unit:</strong> €10M</p>
            <div class="project-details mt-2 pt-2 border-t border-slate-200">
              <p>
                <strong>Opbrengst:</strong> 50% kans op €18M
                <span class="text-green-600 font-semibold">(+€8M)</span>, 50%
                kans op €8M
                <span class="text-red-600 font-semibold">(-€2M)</span>
              </p>
            </div>
          </div>
          <label
            for="invest-better-faster"
            class="font-semibold text-slate-700"
            >Aantal investeringen:</label
          ><input
            type="number"
            id="invest-better-faster"
            min="0"
            value="0"
            class="mt-2 w-full p-2 rounded-lg border-slate-300 border focus:ring-2 focus:ring-purple-500 focus:border-purple-500 transition"
          />
        </div>
        <!-- Card 3: Explore -->
        <div
          class="bg-white p-6 rounded-xl shadow-sm border border-slate-200 card-enter"
        >
          <div class="flex items-center mb-4">
            <div class="bg-amber-100 text-amber-600 p-3 rounded-lg mr-4">
              <svg
                xmlns="http://www.w3.org/2000/svg"
                width="24"
                height="24"
                viewBox="0 0 24 24"
                fill="none"
                stroke="currentColor"
                stroke-width="2"
                stroke-linecap="round"
                stroke-linejoin="round"
              >
                <path
                  d="M16.0614 10.4037L14 17L10 17L7.93865 10.4037C7.35085 8.52273 7.72417 6.47307 8.93738 4.92015L11.5272 1.6052C11.7674 1.29772 12.2326 1.29772 12.4728 1.6052L15.0626 4.92015C16.2758 6.47307 16.6491 8.52273 16.0614 10.4037Z"
                  stroke-width="1.5"
                  stroke-linecap="round"
                  stroke-linejoin="round"
                ></path>
                <path
                  d="M10 20C10 22 12 23 12 23C12 23 14 22 14 20"
                  stroke-width="1.5"
                  stroke-linecap="round"
                  stroke-linejoin="round"
                ></path>
                <path
                  d="M8.5 12.5C5 15 7 19 7 19L10 17"
                  stroke-width="1.5"
                  stroke-linecap="round"
                  stroke-linejoin="round"
                ></path>
                <path
                  d="M15.9312 12.5C19.4312 15 17.4312 19 17.4312 19L14.4312 17"
                  stroke-width="1.5"
                  stroke-linecap="round"
                  stroke-linejoin="round"
                ></path>
                <path
                  d="M12 11C10.8954 11 10 10.1046 10 9C10 7.89543 10.8954 7 12 7C13.1046 7 14 7.89543 14 9C14 10.1046 13.1046 11 12 11Z"
                  stroke-width="1.5"
                  stroke-linecap="round"
                  stroke-linejoin="round"
                ></path>
              </svg>
            </div>
            <div>
              <h2 class="text-xl font-bold text-slate-900">
                Project 'Moonshot'
              </h2>
              <p class="text-sm font-medium text-amber-600">EXPLORE</p>
            </div>
          </div>
          <p class="text-slate-600 mb-4">
            Investeer in een radicale innovatie. Hoog risico, maar een
            potentieel enorme beloning.
          </p>
          <div class="bg-slate-100 p-3 rounded-lg mb-4">
            <p><strong>Kosten per unit:</strong> €5M</p>
            <div class="project-details mt-2 pt-2 border-t border-slate-200">
              <p>
                <strong>Opbrengst:</strong> 20% kans op €50M
                <span class="text-green-600 font-semibold">(+€45M)</span>, 80%
                kans op €0
                <span class="text-red-600 font-semibold">(-€5M)</span>
              </p>
            </div>
          </div>
          <label
            for="invest-moonshot"
            class="font-semibold text-slate-700"
            >Aantal investeringen:</label
          ><input
            type="number"
            id="invest-moonshot"
            min="0"
            value="0"
            class="mt-2 w-full p-2 rounded-lg border-slate-300 border focus:ring-2 focus:ring-amber-500 focus:border-amber-500 transition"
          />
        </div>
      </main>

      <!-- Controls -->
      <footer
        class="mt-6 flex flex-col sm:flex-row items-center justify-center gap-4"
      >
        <button
          id="confirm-button"
          class="w-full sm:w-auto bg-blue-600 text-white font-bold py-3 px-8 rounded-lg hover:bg-blue-700 transition-all shadow-md hover:shadow-lg disabled:bg-slate-400 disabled:cursor-not-allowed disabled:shadow-none"
        >
          Bevestig Investeringen & Ga Naar Volgend Jaar</button
        ><button
          id="restart-button"
          class="w-full sm:w-auto bg-slate-200 text-slate-800 font-bold py-3 px-6 rounded-lg hover:bg-slate-300 transition-all"
        >
          Spel Herstarten
        </button>
      </footer>
    </div>

    <!-- Modal for yearly results -->
    <div
      id="modal"
      class="fixed inset-0 bg-black bg-opacity-60 flex items-center justify-center p-4 z-50 hidden modal-backdrop"
    >
      <div
        class="bg-white rounded-2xl shadow-2xl w-full max-w-md p-6 md:p-8 text-center modal-content"
      >
        <h2
          id="modal-title"
          class="text-2xl font-bold text-slate-900 mb-4"
        >
          Resultaten van Jaar 1
        </h2>
        <div
          id="modal-body"
          class="text-slate-600 space-y-3 mb-6"
        ></div>
        <div
          id="modal-log"
          class="text-left text-sm bg-slate-100 p-4 rounded-lg mb-6 max-h-48 overflow-y-auto"
        ></div>
        <button
          id="modal-close-button"
          class="bg-blue-600 text-white font-bold py-3 px-8 rounded-lg hover:bg-blue-700 transition-all w-full"
        >
          Oké, door naar het volgende jaar!
        </button>
      </div>
    </div>

    <!-- Final Summary Modal -->
    <div
      id="summary-modal"
      class="fixed inset-0 bg-black bg-opacity-60 flex items-center justify-center p-4 z-50 hidden modal-backdrop"
    >
      <div
        class="bg-white rounded-2xl shadow-2xl w-full max-w-3xl p-6 md:p-8 text-left modal-content"
      >
        <h2 class="text-3xl font-bold text-slate-900 mb-2">
          Eindanalyse na 5 Jaar
        </h2>
        <p
          id="summary-final-budget"
          class="text-xl text-blue-600 font-bold mb-6"
        ></p>
        <div class="grid md:grid-cols-2 gap-6">
          <div id="summary-rounds-container"></div>
          <div id="summary-analysis-container"></div>
        </div>
        <button
          id="summary-restart-button"
          class="mt-8 bg-blue-600 text-white font-bold py-3 px-8 rounded-lg hover:bg-blue-700 transition-all w-full"
        >
          Speel Opnieuw
        </button>
      </div>
    </div>

    <!-- Intro Modal -->
    <div
      id="intro-modal"
      class="fixed inset-0 bg-black bg-opacity-60 flex items-center justify-center p-4 z-50 modal-backdrop"
    >
      <div
        class="bg-white rounded-2xl shadow-2xl w-full max-w-lg p-6 md:p-8 text-left modal-content"
      >
        <h2 class="text-2xl font-bold text-slate-900 mb-4">
          Welkom bij het Innovatie Portfolio Spel!
        </h2>
        <div class="text-slate-600 space-y-4">
          <p>
            Je bent het managementteam van een bedrijf en hebt 5 jaar (rondes)
            de tijd om de bedrijfswaarde te maximaliseren.
          </p>
          <p>
            Je start met een budget van
            <strong class="text-blue-600">€100 miljoen</strong>.
          </p>
          <p>
            In elk jaar verdeel je je budget over drie soorten projecten. Denk
            goed na over je strategie. Ga je voor de veilige weg, of durf je te
            investeren in de toekomst? Het doel is om na 5 jaar een zo hoog
            mogelijk budget te hebben.
          </p>
        </div>
        <button
          id="start-game-button"
          class="mt-6 bg-blue-600 text-white font-bold py-3 px-8 rounded-lg hover:bg-blue-700 transition-all w-full"
        >
          Ik snap het, laten we beginnen!
        </button>
      </div>
    </div>

    <script>
      document.addEventListener("DOMContentLoaded", () => {
        const urlParams = new URLSearchParams(window.location.search);
        const showDetails = urlParams.get("showDetails") === "true";

        let state = {};

        const DOMElements = {
          currentYear: document.getElementById("current-year"),
          startBudget: document.getElementById("start-budget"),
          investedAmount: document.getElementById("invested-amount"),
          remainingBudget: document.getElementById("remaining-budget"),
          investCashCow: document.getElementById("invest-cash-cow"),
          investBetterFaster: document.getElementById("invest-better-faster"),
          investMoonshot: document.getElementById("invest-moonshot"),
          confirmButton: document.getElementById("confirm-button"),
          restartButton: document.getElementById("restart-button"),
          modal: document.getElementById("modal"),
          modalTitle: document.getElementById("modal-title"),
          modalBody: document.getElementById("modal-body"),
          modalLog: document.getElementById("modal-log"),
          modalCloseButton: document.getElementById("modal-close-button"),
          introModal: document.getElementById("intro-modal"),
          startGameButton: document.getElementById("start-game-button"),
          summaryModal: document.getElementById("summary-modal"),
          summaryFinalBudget: document.getElementById("summary-final-budget"),
          summaryRoundsContainer: document.getElementById(
            "summary-rounds-container"
          ),
          summaryAnalysisContainer: document.getElementById(
            "summary-analysis-container"
          ),
          summaryRestartButton: document.getElementById(
            "summary-restart-button"
          ),
          projectDetails: document.querySelectorAll(".project-details"),
        };

        const COSTS = { cashCow: 20, betterFaster: 10, moonshot: 5 };

        function initGame() {
          state = {
            currentYear: 1,
            totalBudget: 100,
            gameLog: [],
            isGameOver: false,
          };
          resetInputs();
          updateDashboard();
          toggleDetailsVisibility(showDetails);
          DOMElements.confirmButton.disabled = false;
          DOMElements.modal.classList.add("hidden");
          DOMElements.summaryModal.classList.add("hidden");
          DOMElements.introModal.classList.remove("hidden");
          DOMElements.introModal.querySelector(
            ".modal-content"
          ).style.transform = "scale(1)";
          DOMElements.introModal.style.opacity = "1";
        }

        function toggleDetailsVisibility(show) {
          DOMElements.projectDetails.forEach((detail) => {
            if (show) {
              detail.classList.remove("hidden");
            } else {
              detail.classList.add("hidden");
            }
          });
        }

        function updateDashboard() {
          const investments = getInvestments();
          const totalInvested =
            investments.cashCow * COSTS.cashCow +
            investments.betterFaster * COSTS.betterFaster +
            investments.moonshot * COSTS.moonshot;
          const remaining = state.totalBudget - totalInvested;
          DOMElements.currentYear.textContent = `${state.currentYear} / 5`;
          DOMElements.startBudget.textContent = `€${state.totalBudget}M`;
          DOMElements.investedAmount.textContent = `€${totalInvested}M`;
          DOMElements.remainingBudget.textContent = `€${remaining}M`;
          DOMElements.remainingBudget.classList.toggle(
            "text-red-600",
            remaining < 0
          );
          DOMElements.remainingBudget.classList.toggle(
            "text-green-600",
            remaining >= 0
          );
          DOMElements.confirmButton.disabled = remaining < 0;
        }

        function getInvestments() {
          return {
            cashCow: parseInt(DOMElements.investCashCow.value) || 0,
            betterFaster: parseInt(DOMElements.investBetterFaster.value) || 0,
            moonshot: parseInt(DOMElements.investMoonshot.value) || 0,
          };
        }

        function resetInputs() {
          DOMElements.investCashCow.value = 0;
          DOMElements.investBetterFaster.value = 0;
          DOMElements.investMoonshot.value = 0;
        }

        function handleNextRound() {
          if (state.isGameOver) return;
          const investments = getInvestments();
          const cost =
            investments.cashCow * COSTS.cashCow +
            investments.betterFaster * COSTS.betterFaster +
            investments.moonshot * COSTS.moonshot;
          if (cost > state.totalBudget) {
            return;
          }

          let roundResult = { profit: 0, log: [], outcomes: [] };

          // --- Project 'Cash Cow' ---
          const cashCowProfit = investments.cashCow * 5;
          roundResult.profit += cashCowProfit;
          if (investments.cashCow > 0) {
            roundResult.log.push(
              `<p>✅ 'Cash Cow' leverde <span class="font-bold text-green-600">+€${cashCowProfit}M</span> op.</p>`
            );
            roundResult.outcomes.push({
              project: "cashCow",
              invested: investments.cashCow * COSTS.cashCow,
              returned: investments.cashCow * (COSTS.cashCow + 5),
            });
          }

          // --- Project 'Better Faster' ---
          let betterFasterProfit = 0;
          for (let i = 0; i < investments.betterFaster; i++) {
            if (Math.random() <= 0.5) {
              betterFasterProfit += 8;
              roundResult.log.push(
                `<p>👍 'Better Faster' succes! <span class="font-bold text-green-600">+€8M</span></p>`
              );
              roundResult.outcomes.push({
                project: "betterFaster",
                invested: COSTS.betterFaster,
                returned: 18,
              });
            } else {
              betterFasterProfit -= 2;
              roundResult.log.push(
                `<p>👎 'Better Faster' faalde. <span class="font-bold text-red-600">-€2M</span></p>`
              );
              roundResult.outcomes.push({
                project: "betterFaster",
                invested: COSTS.betterFaster,
                returned: 8,
              });
            }
          }
          roundResult.profit += betterFasterProfit;

          // --- Project 'Moonshot' ---
          let moonshotProfit = 0;
          for (let i = 0; i < investments.moonshot; i++) {
            if (Math.random() <= 0.2) {
              moonshotProfit += 45;
              roundResult.log.push(
                `<p>🚀 'MOONSHOT' DOORBRAAK! <span class="font-bold text-green-600">+€45M</span></p>`
              );
              roundResult.outcomes.push({
                project: "moonshot",
                invested: COSTS.moonshot,
                returned: 50,
              });
            } else {
              moonshotProfit -= 5;
              roundResult.log.push(
                `<p>💥 'Moonshot' mislukt. <span class="font-bold text-red-600">-€5M</span></p>`
              );
              roundResult.outcomes.push({
                project: "moonshot",
                invested: COSTS.moonshot,
                returned: 0,
              });
            }
          }
          roundResult.profit += moonshotProfit;

          if (cost === 0)
            roundResult.log.push(`<p>😴 Niet geïnvesteerd dit jaar.</p>`);

          const initialBudgetForRound = state.totalBudget;
          // The new total budget is the initial budget for the round MINUS the cost, PLUS the return from the investment.
          // This is equivalent to initial budget + profit.
          const newTotalBudget = initialBudgetForRound + roundResult.profit;

          state.gameLog.push({
            year: state.currentYear,
            initialBudget: initialBudgetForRound,
            investments: investments,
            cost: cost,
            profit: roundResult.profit,
            finalBudget: newTotalBudget,
            log: roundResult.log,
            outcomes: roundResult.outcomes,
          });

          state.totalBudget = newTotalBudget;
          state.currentYear++;

          if (state.currentYear > 5) {
            state.isGameOver = true;
            showFinalSummary();
          } else {
            showYearlyResultsModal(state.gameLog[state.gameLog.length - 1]);
          }
        }

        function showYearlyResultsModal(logEntry) {
          DOMElements.modalTitle.textContent = `Resultaten van Jaar ${logEntry.year}`;
          const netResult = logEntry.profit;
          DOMElements.modalBody.innerHTML = `<p>Startbudget: <strong>€${
            logEntry.initialBudget
          }M</strong></p><p>Investering: <strong>€${
            logEntry.cost
          }M</strong></p><p>Netto: <strong class="${
            netResult >= 0 ? "text-green-600" : "text-red-600"
          }">€${
            netResult >= 0 ? "+" : ""
          }${netResult}M</strong></p><hr class="my-4"><p class="text-xl">Nieuw budget: <strong class="text-blue-600">€${
            logEntry.finalBudget
          }M</strong></p>`;
          DOMElements.modalLog.innerHTML = logEntry.log.join("");
          DOMElements.modalCloseButton.textContent = `Oké, door naar jaar ${state.currentYear}`;

          DOMElements.modal.classList.remove("hidden");
          DOMElements.modal.style.opacity = "1";
          DOMElements.modal.querySelector(".modal-content").style.transform =
            "scale(1)";
        }

        function showFinalSummary() {
          DOMElements.summaryFinalBudget.innerHTML = `Eindbudget: €${state.totalBudget}M`;

          // Part 1: Yearly results (unchanged)
          let roundsHtml = `<h3 class="text-xl font-bold text-slate-800 mb-3">Resultaten per Jaar</h3><div class="space-y-2">`;
          state.gameLog.forEach((log) => {
            const profitColor =
              log.profit >= 0 ? "text-green-600" : "text-red-600";
            roundsHtml += `<div class="bg-slate-100 p-3 rounded-lg"><p class="font-semibold">Jaar ${
              log.year
            } &rarr; Eindbudget: €${
              log.finalBudget
            }M</p><p class="text-sm">Investering: €${
              log.cost
            }M | Resultaat: <span class="font-bold ${profitColor}">€${
              log.profit >= 0 ? "+" : ""
            }${log.profit}M</span></p></div>`;
          });
          roundsHtml += `</div>`;
          DOMElements.summaryRoundsContainer.innerHTML = roundsHtml;

          // Part 2: Analysis (MODIFIED)
          const analysis = {
            cashCow: { invested: 0, returned: 0 },
            betterFaster: { invested: 0, returned: 0 },
            moonshot: { invested: 0, returned: 0 },
          };

          state.gameLog.forEach((log) => {
            if (!log.outcomes) return;
            log.outcomes.forEach((outcome) => {
              analysis[outcome.project].invested += outcome.invested;
              analysis[outcome.project].returned += outcome.returned;
            });
          });

          // --- NEW: Build the analysis HTML with ROI ---
          let analysisHtml = `<h3 class="text-xl font-bold text-slate-800 mb-3">Cash Flow Analyse</h3><div class="space-y-6">`;

          const maxVal = Math.max(
            ...Object.values(analysis).flatMap((v) => [v.invested, v.returned]),
            1
          );

          const createBar = (label, value, color, maxValue) => {
            const width = maxValue > 0 ? (value / maxValue) * 100 : 0;
            return `<div class="flex items-center"><p class="w-28 text-sm text-slate-600">${label}</p><div class="flex-grow bg-slate-200 rounded-full h-5"><div class="bar ${color} h-5 rounded-full text-white text-xs flex items-center justify-end pr-2" style="width: ${width}%">${
              value > 0 ? `€${value}M` : ""
            }</div></div></div>`;
          };

          const createProjectAnalysisBlock = (
            title,
            projectData,
            barColor,
            riskLabel
          ) => {
            const { invested, returned } = projectData;
            const profit = returned - invested;
            // ROI formula: 100 * (returned - invested) / invested
            const roi =
              invested > 0 ? ((returned - invested) / invested) * 100 : 0;
            const roiColor = roi >= 0 ? "text-green-600" : "text-red-600";
            const profitSign = profit >= 0 ? "+" : "";

            return `
                            <div>
                                <p class="font-semibold mb-2">${title} <span class="text-sm font-normal text-slate-500">(${riskLabel})</span></p>
                                <div class="space-y-1.5 bg-slate-50 p-3 rounded-lg border border-slate-200">
                                    ${createBar(
                                      "Cash Out (-)",
                                      invested,
                                      "bg-red-400",
                                      maxVal
                                    )}
                                    ${createBar(
                                      "Cash In (+)",
                                      returned,
                                      barColor,
                                      maxVal
                                    )}
                                </div>
                                <div class="mt-2 text-sm text-right pr-1">
                                    Netto: <span class="font-bold ${roiColor}">${profitSign}€${profit}M</span> | 
                                    Rendement: <span class="font-bold ${roiColor}">${roi.toFixed(
              0
            )}%</span>
                                </div>
                            </div>
                        `;
          };

          analysisHtml += createProjectAnalysisBlock(
            "Project 'Cash Cow'",
            analysis.cashCow,
            "bg-blue-600",
            "Laag Risico"
          );
          analysisHtml += createProjectAnalysisBlock(
            "Project 'Better Faster'",
            analysis.betterFaster,
            "bg-purple-600",
            "Medium Risico"
          );
          analysisHtml += createProjectAnalysisBlock(
            "Project 'Moonshot'",
            analysis.moonshot,
            "bg-amber-600",
            "Hoog Risico"
          );

          analysisHtml += `</div>`;
          DOMElements.summaryAnalysisContainer.innerHTML = analysisHtml;

          DOMElements.summaryModal.classList.remove("hidden");
          DOMElements.summaryModal.style.opacity = "1";
          DOMElements.summaryModal.querySelector(
            ".modal-content"
          ).style.transform = "scale(1)";
        }

        function closeModal(isSummary = false) {
          const modalToClose = isSummary
            ? DOMElements.summaryModal
            : DOMElements.modal;
          modalToClose.style.opacity = "0";
          modalToClose.querySelector(".modal-content").style.transform =
            "scale(0.95)";
          setTimeout(() => {
            modalToClose.classList.add("hidden");
            if (state.isGameOver) {
              initGame();
            } else {
              resetInputs();
              updateDashboard();
            }
          }, 300);
        }

        [
          DOMElements.investCashCow,
          DOMElements.investBetterFaster,
          DOMElements.investMoonshot,
        ].forEach((input) => input.addEventListener("input", updateDashboard));
        DOMElements.confirmButton.addEventListener("click", handleNextRound);
        DOMElements.restartButton.addEventListener("click", initGame);
        DOMElements.modalCloseButton.addEventListener("click", () =>
          closeModal(false)
        );
        DOMElements.summaryRestartButton.addEventListener("click", () =>
          closeModal(true)
        );
        DOMElements.startGameButton.addEventListener("click", () => {
          DOMElements.introModal.style.opacity = "0";
          DOMElements.introModal.querySelector(
            ".modal-content"
          ).style.transform = "scale(0.95)";
          setTimeout(() => DOMElements.introModal.classList.add("hidden"), 300);
        });

        initGame();
      });
    </script>
  </body>
</html>